# 实现细节

## 架构分层
1. **应用层** - 简单安全的API (`KcpApplicationPacket`, `KcpSendResult`)
2. **协议层** - 完整KCP协议实现 (`KcpConnectionBase`)
3. **传输层** - UDP具体实现 (`KcpConnection`)

## 关键设计决策
- **字节序透明处理**：自动处理网络小端字节序与主机字节序转换
- **接收方驱动流量控制**：窗口满时不发送ACK，触发对端重传
- **异步友好**：原生支持的异步API，支持CancellationToken
- **资源自动管理**：内部缓冲区使用ArrayPool，减少GC压力

## 配置选项
以下配置选项数据源自原始实现作者skywind3000。
```csharp
// 低延迟配置（游戏、实时音视频）
connection.ConfigureNoDelay(
    nodelay: true,     // 启用无延迟模式
    interval: 10,      // 10ms更新间隔
    resend: 2,         // 快速重传触发次数
    nc: false          // 保持拥塞控制
);

// 高吞吐量配置（文件传输）
connection.ConfigureNoDelay(
    nodelay: false,    // 关闭无延迟模式
    interval: 50,      // 50ms更新间隔
    resend: 0,         // 禁用快速重传
    nc: true           // 关闭拥塞控制（仅在可控网络中使用）
);
```
---
本文完全由人工编写，没有机器人参与🤖  
IP属地：生化斯坦